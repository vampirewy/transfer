(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{PksI:function(t,e,i){"use strict";i("Z8na")},Z8na:function(t,e,i){},mxxW:function(t,e,i){"use strict";i.r(e);var a={name:"create_edit",data:()=>({routeType:1,form:{labelPosition:"right",labelWidth:"60px",name:"",remark:"",libraryId:"",dataSource:[]},table:{list:[],itemIdList:[]},rules:{libraryId:[{required:!0,message:"请选择体检库"}],name:[{required:!0,message:"模板名称不能为空"}]}}),mounted(){this.onLoad(),this.getList()},computed:{isEdit(){return!!this.$route.params.id}},methods:{onLoad(){const t=this.$route;"physical_project_template_create"===t.meta.type?this.routeType=1:"physical_project_template_edit"===t.meta.type&&(this.routeType=2,this.getDetail())},onChange(t,e){if(e)t.organItemDTOList?t.organItemDTOList.forEach(t=>{const e=t;e.checked=!0,this.table.itemIdList.includes(e.id)||this.table.itemIdList.push(e.id)}):(this.table.itemIdList.includes(t.id)||this.table.itemIdList.push(t.id),this.checkisIndeterminate(t));else if(t.organItemDTOList)t.organItemDTOList.forEach(t=>{const e=t;e.checked=!1;const i=this.table.itemIdList.indexOf(e.id);-1!==i&&this.table.itemIdList.splice(i,1)});else{const e=this.table.itemIdList.indexOf(t.id);-1!==e&&this.table.itemIdList.splice(e,1),this.checkisIndeterminate(t)}},checkisIndeterminate(t){const e=this.table.list.find(e=>e.sectionName===t.sectionName);if(e){const t=e.organItemDTOList.filter(t=>t.checked);0===t.length?(this.$set(e,"isIndeterminate",!1),e.checked=!1):t.length===e.organItemDTOList.length?(this.$set(e,"isIndeterminate",!1),e.checked=!0):this.$set(e,"isIndeterminate",!0)}},async changeLibrary(t){const{data:e}=await this.$api.physicalProjectListInterface.changeLibrary({libraryId:t});this.$set(this.table,"list",e.data),this.$set(this.table,"itemIdList",[]),this.table.list.forEach((t,e)=>{const i=t;return i.id=e+"a",i})},async getList(){const t=await this.$api.physicalProjectListInterface.listOrganItemLibrary(),{data:e}=t.data;this.form.dataSource=e},async getDetail(){const t={id:this.$route.params.id},e=await this.$api.physicalProjectTemplateInterface.getReportTemplate(t),{data:i}=e.data;this.form.name=i.name,this.form.remark=i.remark,this.form.libraryId=i.libraryId,this.$set(this.table,"list",i.reportTemplateTreeList),this.$set(this.table,"itemIdList",[]),this.table.list.forEach((t,e)=>{const i=t;i.id=e+"a",i.isIndeterminate=!1;let a=0;return i.organItemDTOList.forEach(t=>{t.checked&&(this.table.itemIdList.push(t.id),a++)}),0===a?i.isIndeterminate=!1:a===i.organItemDTOList.length?(i.isIndeterminate=!1,i.checked=!0):a>0&&a<i.organItemDTOList.length&&(i.isIndeterminate=!0),i})},handleRemove(t){this.table.list.splice(t.$index,1)},cancel(){this.$router.push({path:"/basic_data/physical_project_template"})},async save(){this.$refs.form.validate(async t=>{if(t){const t=this.table.itemIdList,e={libraryId:this.form.libraryId,name:this.form.name,remark:this.form.remark,itemIdList:t};1===this.routeType?await this.$api.physicalProjectTemplateInterface.saveReportTemplate(e):2===this.routeType&&(e.id=this.$route.params.id,await this.$api.physicalProjectTemplateInterface.updateReportTemplate(e)),1===this.routeType&&Object.assign(this.$data,this.$options.data()),this.$message.success("操作成功"),this.cancel()}})}}},s=(i("PksI"),i("KHd+")),r=Object(s.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"create-edit"},[i("el-form",{ref:"form",staticClass:"form-inline inputCommon",attrs:{inline:!1,rules:t.rules,"label-position":t.form.labelPosition,model:t.form}},[i("el-form-item",[i("div",{staticClass:"divRight"},[i("div",{staticClass:"divRightTitleDiv"},[i("div",{staticClass:"divRightTitle"},[i("span",[t._v("|")]),t._v(t._s(t.isEdit?"编辑":"新增")+"-体检项目模板主信息\n          ")])])])]),t._v(" "),i("div",{staticClass:"row"},[i("el-form-item",{staticStyle:{width:"25%"},attrs:{label:"体检库",prop:"libraryId","label-width":"100px"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:t.changeLibrary},model:{value:t.form.libraryId,callback:function(e){t.$set(t.form,"libraryId",e)},expression:"form.libraryId"}},t._l(t.form.dataSource,(function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),t._v(" "),i("el-form-item",{staticStyle:{width:"25%"},attrs:{label:"模板名称",prop:"name","label-width":"130px"}},[i("el-input",{staticStyle:{width:"230px"},attrs:{placeholder:"请输入模板名称",maxlength:"30"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"描述","label-width":t.form.labelWidth}},[i("el-input",{attrs:{type:"textarea",maxlength:"400","show-word-limit":"",rows:"4",placeholder:"请输入描述"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),t._v(" "),i("el-form-item",[i("div",{staticClass:"divRight"},[i("div",{staticClass:"divRightTitleDiv"},[i("div",{staticClass:"divRightTitle"},[i("span",[t._v("|")]),t._v("体检库")])])])]),t._v(" "),i("el-form-item",{attrs:{label:"","label-width":t.form.labelWidth}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.table.list,"row-key":"id","dark-header":"","tree-props":{children:"organItemDTOList"}}},[i("el-table-column",{attrs:{prop:"sectionName",label:"名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-checkbox",{attrs:{indeterminate:e.row.isIndeterminate},on:{change:function(i){return t.onChange(e.row,i)}},model:{value:e.row.checked,callback:function(i){t.$set(e.row,"checked",i)},expression:"scope.row.checked"}}),t._v("\n            "+t._s(e.row.itemName||e.row.sectionName)+"\n          ")]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"gender",label:"性别"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.gender?i("span",[t._v("男")]):t._e(),t._v(" "),2===e.row.gender?i("span",[t._v("女")]):t._e()]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"refRange",label:"正常范围"}}),t._v(" "),i("el-table-column",{attrs:{prop:"unit",label:"单位"}})],1)],1),t._v(" "),i("div",{staticClass:"footer"},[i("el-button",{staticClass:"reset-btn",attrs:{size:"small"},on:{click:t.cancel}},[t._v("返回")]),t._v(" "),i("el-button",{staticClass:"add-btn",attrs:{type:"primary",size:"small"},on:{click:t.save}},[t._v("保存")])],1)],1)],1)}),[],!1,null,"1695b8df",null);e.default=r.exports}}]);