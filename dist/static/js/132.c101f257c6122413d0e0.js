(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{FhEY:function(e,t,a){"use strict";a.r(t);var s=[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"divTitle"},[t("span",[t("img",{attrs:{src:a("OygJ"),alt:""}})]),this._v("\n      待随访计划\n    ")])}],l=a("7rXy"),r=a("IZzX"),o=a("M07H"),n=a("pvXR"),i=a("aVcm"),c=a("TcFo"),d=a("5i/l"),p=a.n(d),u=a("u3Oj"),m=a("/Vet"),f={name:"user_follow_do",components:{QueryPage:r.a,Search:o.a,QueryFilter:n.a,OperateButton:i.a,ManagerList:c.a,InterventionAddMdl:u.a,userOpen:m.a},data(){return{isTrue:!0,form:{keywords:"",gender:"",workUnitName:"",planUserId:"",planDate:"",planWay:"",startTime:"",endTime:"",executeState:"2",gridId:"",tag:"",startPlanTime:"",endPlanTime:"",startCreatedTime:"",endCreatedTime:"",planUserIdList:[],createdByList:[],genderList:l.b,executeStateList:l.a},selectPlanuser:[],planUserName:"",planuserModalVisible:!1,createUserName:"",createUserModalVisible:!1,gridList:[],planWayList:[],table:{list:[],totalCount:0,currentPage:1,pageSize:15},multipleSelection:[],pickerStartTime:{disabledDate:e=>{if(this.form.endTime){const t=new Date(this.form.endTime);return e.getTime()>new Date(t).getTime()-828e5}}},pickerEndTime:{disabledDate:e=>{if(this.form.startTime){const t=new Date(this.form.startTime);return e.getTime()<new Date(t).getTime()-828e5}}}}},activated(){this.onLoad()},methods:{handleSelectionChange(e){this.multipleSelection=e},onLoad(){this.getList(),this.getPlanWayList(),this.getGridList()},handleCreateUserSelectChange(e){this.$refs.createUserPopover.doClose(),this.createUserModalVisible=!1;const t=[],a=[];e.forEach(e=>{t.push(e.realName),a.push(e.id)}),this.form.createdByList=a,this.createUserName=t.join(",")},handleCreateUserClose(){this.createUserModalVisible=!1,this.$refs.createUserPopover.doClose()},handlePlanuserSelectChange(e){this.$refs.userPopover.doClose(),this.planuserModalVisible=!1;const t=[],a=[];e.forEach(e=>{t.push(e.realName),a.push(e.id)}),console.log(e),this.form.planUserIdList=a,this.planUserName=t.join(",")},handlePlanuserClose(){this.planuserModalVisible=!1,this.$refs.userPopover.doClose()},getPlanUserSelectedList(){const e=[];return this.form.planUserIdList.forEach(t=>{e.push({id:t})}),e},async getList(){const e={keywords:this.form.keywords,gender:this.form.gender,gridId:this.form.gridId,planWay:this.form.planWay,tag:this.form.tag,startPlanTime:this.form.startPlanTime,endPlanTime:this.form.endPlanTime,startCreatedTime:this.form.startCreatedTime,endCreatedTime:this.form.endCreatedTime,planUserIdList:this.form.planUserIdList,createdByList:this.form.createdByList,pageNo:this.table.currentPage,pageSize:this.table.pageSize},t=await this.$api.userFollowInterface.getIntervenePlanListPage(e),{data:a}=t.data;a&&(this.table.list=a.data||[],this.table.totalCount=a.total)},upMore(){this.isTrue=!this.isTrue},async getPlanWayList(){const e=await this.$api.userFollowInterface.getIntervenePlanWayList(),{data:t}=e.data,a=t.map(e=>{const{id:t,name:a}=e;return{id:t,name:a}});this.planWayList=a},async getGridList(){const e=await this.$api.userManagerInterface.getGridList({pageNo:1,pageSize:1e4}),{data:t}=e.data;this.gridList=t.data},async editUserFollow(e){const t=[e.clientId],a=[Object.assign({},e)];a.forEach(e=>{const t=e;t.ignore=!1,t.planUserId=e.planDoctor,1===e.planTime.split(" ").length?t.planDate=e.planTime+" 00:00:00":2===e.planTime.split(" ").length&&(t.planDate=e.planTime)});const s={organId:"",clientIds:t,intervenePlans:a.filter(e=>!e.ignore)};return await this.$api.userFollowInterface.saveIntervenePlan(s),this.$message.success("操作成功"),this.getList()},handleEditPlan(e){const t=e;t.planTime=t.planDate,this.$jDynamic.show({component:"InterventionAddMdl",data:{modalType:2,addType:"2",editType:2,modalTitle:"编辑",propsData:t,confirmfunc:async e=>{const a=e;a.id=t.id,a.clientId=t.clientId,this.editUserFollow(a)}},render:e=>e(u.a)})},handleSomeRemove(){0!==this.multipleSelection.length?this.$confirm(`<div class="delete-text-content"><img class="delete-icon" src="${p.a}"/><span>该操作无法撤销，是否确认删除！</span></div>`,"删除提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",customClass:"message-box-customize",showClose:!0}).then(async()=>{const e=[];this.multipleSelection.forEach(t=>{e.push(t.id)});const t=e;return await this.$api.userFollowInterface.deleteSomeFollowplanDel(t),this.$message.success("操作成功"),this.getList()}):this.$message({message:"请选择要删除的记录",type:"warning"})},viewiFollowPlanDetail(e){this.$router.push({path:"/health_plan/user_follow_do/do/"+e.id})},onSearch(){this.table.currentPage=1,this.getList()},onReset(){Object.assign(this.$data,this.$options.data()),this.table.currentPage=1,this.onLoad()},handleClose(e){this.$confirm("确定要关闭吗?","提示",{type:"warning"}).then(async()=>{const t={id:e.id,organId:"",clientId:"",planWay:e.planWay,planTitle:e.planTitle,planContent:e.planContent,planDate:e.planDate,planRemark:e.planRemarrk,executeState:"4",executePlanWay:"",executePlanContent:"",assortLevel:e.assortLevel,collectionQuestionType:e.collectionQuestionType};return await this.$api.userFollowInterface.intervenePlanUpdate(t),this.$message.success("操作成功"),this.getList()})},handleChange(e){this.table.currentPage=e,this.getList()}}},h=(a("kETK"),a("KHd+")),v=Object(h.a)(f,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"divTop"},[e._m(0),e._v(" "),s("div",{staticClass:"searchCondition"},[s("div",{staticClass:"searchLeft"},[s("div",{staticClass:"searchInputFormItem"},[s("el-input",{attrs:{placeholder:"姓名/编号/单位"},model:{value:e.form.keywords,callback:function(t){e.$set(e.form,"keywords",t)},expression:"form.keywords"}}),e._v(" "),s("span",{staticClass:"searchBtnImgSpan",on:{click:e.onSearch}},[s("img",{staticClass:"searchBtnImg",attrs:{src:a("RQrH")}})])],1),e._v(" "),s("div",[s("span",[e._v("客户性别：")]),e._v(" "),s("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[s("el-option",{key:"1",attrs:{label:"男",value:"1"}}),e._v(" "),s("el-option",{key:"2",attrs:{label:"女",value:"2"}})],1)],1),e._v(" "),s("div",[s("span",[e._v("人员类别：")]),e._v(" "),s("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.form.gridId,callback:function(t){e.$set(e.form,"gridId",t)},expression:"form.gridId"}},e._l(e.gridList,(function(e,t){return s("el-option",{key:t,attrs:{label:e.gridName,value:e.id}})})),1)],1),e._v(" "),s("div",[s("span",[e._v("随访方式：")]),e._v(" "),s("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.form.planWay,callback:function(t){e.$set(e.form,"planWay",t)},expression:"form.planWay"}},e._l(e.planWayList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)]),e._v(" "),s("div",{staticClass:"searchRight"},[s("div",{staticClass:"buttones"},[s("div",{staticClass:"searchFor",on:{click:function(t){return e.onSearch(1)}}},[s("img",{attrs:{src:a("nc5h"),alt:""}})]),e._v(" "),s("div",{staticClass:"resetAll",on:{click:e.onReset}},[e._v("重置")]),e._v(" "),e.isTrue?s("div",{staticClass:"more",on:{click:e.upMore}},[s("span",[e._v(">")]),e._v("\n            展开更多")]):s("div",{staticClass:"more noMore",on:{click:e.upMore}},[s("span",[e._v(">")]),e._v("收起筛选")])])])])]),e._v(" "),e.isTrue?e._e():s("div",{staticClass:"searchCondition"},[s("div",{staticClass:"searchLeft",staticStyle:{"padding-left":"5px"}},[s("div",[s("span",[e._v("随访医生：")]),e._v(" "),s("el-popover",{ref:"userPopover",attrs:{placement:"top-start",width:"545",trigger:"click"},on:{show:function(t){e.planuserModalVisible=!0},hide:function(t){e.planuserModalVisible=!1}}},[e.planuserModalVisible?s("manager-list",{attrs:{selectedList:e.getPlanUserSelectedList()},on:{change:e.handlePlanuserSelectChange,cancel:e.handlePlanuserClose}}):e._e(),e._v(" "),s("el-input",{staticClass:"select-user-trigger",staticStyle:{width:"140px"},attrs:{slot:"reference",disabled:""===e.planUserName,placeholder:"请输入"},slot:"reference",model:{value:e.planUserName,callback:function(t){e.planUserName=t},expression:"planUserName"}},[s("i",{class:"el-icon-arrow-"+(e.planuserModalVisible?"up":"down"),attrs:{slot:"suffix"},slot:"suffix"})])],1)],1),e._v(" "),s("div",[s("span",[e._v("创建人：")]),e._v(" "),s("el-popover",{ref:"createUserPopover",attrs:{placement:"top-start",width:"590",trigger:"click"},on:{show:function(t){e.createUserModalVisible=!0},hide:e.handleCreateUserClose}},[e.createUserModalVisible?s("user-open",{attrs:{selectedList:e.form.createdByList},on:{change:e.handleCreateUserSelectChange,cancel:e.handleCreateUserClose}}):e._e(),e._v(" "),s("el-input",{staticClass:"select-user-trigger",staticStyle:{width:"140px"},attrs:{slot:"reference",disabled:""===e.createUserName,placeholder:"请选择"},slot:"reference",model:{value:e.createUserName,callback:function(t){e.createUserName=t},expression:"createUserName"}},[s("i",{class:"el-icon-arrow-"+(e.createUserModalVisible?"up":"down"),attrs:{slot:"suffix"},slot:"suffix"})])],1)],1),e._v(" "),s("div",[s("span",[e._v("客户标签：")]),e._v(" "),s("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"请输入"},model:{value:e.form.tag,callback:function(t){e.$set(e.form,"tag",t)},expression:"form.tag"}})],1),e._v(" "),s("div",[s("span",[e._v("随访日期：")]),e._v(" "),s("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date","value-format":"yyyy-MM-dd","max-date":e.form.endPlanTime,placeholder:"开始时间"},model:{value:e.form.startPlanTime,callback:function(t){e.$set(e.form,"startPlanTime",t)},expression:"form.startPlanTime"}}),e._v(" "),s("span",{staticClass:"timing"},[e._v("-")]),e._v(" "),s("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date","value-format":"yyyy-MM-dd","min-date":e.form.startPlanTime,placeholder:"结束时间"},model:{value:e.form.endPlanTime,callback:function(t){e.$set(e.form,"endPlanTime",t)},expression:"form.endPlanTime"}})],1),e._v(" "),s("div",[s("span",[e._v("创建日期：")]),e._v(" "),s("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date","value-format":"yyyy-MM-dd","max-date":e.form.endCreatedTime,placeholder:"开始时间"},model:{value:e.form.startCreatedTime,callback:function(t){e.$set(e.form,"startCreatedTime",t)},expression:"form.startCreatedTime"}}),e._v(" "),s("span",{staticClass:"timing"},[e._v("-")]),e._v(" "),s("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date","value-format":"yyyy-MM-dd","min-date":e.form.startCreatedTime,placeholder:"结束时间"},model:{value:e.form.endCreatedTime,callback:function(t){e.$set(e.form,"endCreatedTime",t)},expression:"form.endCreatedTime"}})],1)])]),e._v(" "),s("div",{staticClass:"topbottomborder"}),e._v(" "),s("div",{staticClass:"divRightTitleDiv"},[s("div",[e.getAccess("wait_visit_plan_batch_delete")?s("el-button",{staticClass:"btn-new btnDel",staticStyle:{margin:"16px 0"},attrs:{size:"small"},on:{click:e.handleSomeRemove}},[s("img",{attrs:{src:a("IKay")}}),e._v("删除")]):e._e()],1)]),e._v(" "),s("div",{staticClass:"user-follow"},[s("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.table.list,align:"center"},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),s("el-table-column",{attrs:{prop:"clientNo",label:"客户编号","min-width":"90","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n          "+e._s(e._f("getResult")(t.row.clientNo)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"clientName",label:"姓名",width:"70","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{staticClass:"clientName",on:{click:function(a){return e.commonHref.toPersonalHealth(t.row.clientId,e.$router)}}},[e._v("\n                "+e._s(e._f("getResult")(t.row.clientName))+"\n              ")])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"gender",label:"性别",width:"55px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v(e._s(e._f("getResultGender")(t.row.gender)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"age",label:"年龄",width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n            "+e._s(e._f("getResult")(t.row.age)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"gridName",label:"人员类别","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n          "+e._s(e._f("getResult")(t.row.gridName)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"workUnitName",label:"单位"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n          "+e._s(e._f("getResult")(t.row.workUnitName)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"mobile",label:"手机号码",width:"90px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n          "+e._s(e._f("getResult")(t.row.mobile)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"planUserName",label:"随访标题","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n          "+e._s(e._f("getResult")(t.row.planTitle)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"planUserName",label:"随访方式","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n          "+e._s(e._f("getResult")(t.row.planWayName)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"planUserName",label:"随访内容","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n          "+e._s(e._f("getResult")(t.row.planContent)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"templateQuestionName",label:"随访问卷","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n          "+e._s(e._f("getResult")(t.row.templateQuestionName)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"planUserName",label:"干预人","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v("\n          "+e._s(e._f("getResult")(t.row.planUserName)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"executeTime",label:"随访日期",width:"120px","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v(e._s(e._f("getResultDate")(t.row.planDate)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"createdByName",label:"创建人","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{class:{redToday:1===t.row.todayPlanDate,overToday:3===t.row.executeState}},[e._v(e._s(e._f("getResult")(t.row.createdByName)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.getAccess("wait_visit_plan_edit")?s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleEditPlan(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),e.getAccess("wait_visit_plan_exec")?s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.viewiFollowPlanDetail(t.row)}}},[e._v("执行")]):e._e()]}}])})],1),e._v(" "),s("div",{staticClass:"warn"},[e._v("\n          注：表格内红色文字代表当天计划\n        ")]),e._v(" "),s("div",{staticClass:"over"},[e._v("\n          注：表格内橙色文字代表已逾期计划\n        ")]),e._v(" "),s("el-pagination",{attrs:{background:"","current-page":e.table.currentPage,"page-size":e.table.pageSize,layout:"prev, pager, next, jumper, total, sizes",total:e.table.totalCount,pageSizes:[15],"pager-count":4},on:{"current-change":e.handleChange}})],1)])}),s,!1,null,"59a611aa",null);t.default=v.exports},hrqi:function(e,t,a){},kETK:function(e,t,a){"use strict";a("hrqi")}}]);